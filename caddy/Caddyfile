ebudget.se, www.ebudget.se {
    encode zstd gzip

    handle /api/healthz* { respond 404 }
    handle /api/readyz*  { respond 404 }

    handle /api/* {
        reverse_proxy backend:8080
    }

    # Serve the *symlinked* dir (/opt/steenbudget/frontend/dist on host)
    handle {
        root * /srv/dist
        try_files {path} /index.html
        file_server
    }

    tls {
        dns cloudflare {env.CLOUDFLARE_API_TOKEN}
    }

    # Cache policy: no-cache HTML, long-cache assets
    @html {
        path_regexp html .*\.html$
    }
    header @html Cache-Control "no-cache"
    @assets {
        path *.js *.css *.png *.jpg *.svg *.woff2
    }
    header @assets Cache-Control "public, max-age=31536000, immutable"
}
